#!/bin/bash

# Produce JBrowse2-compatible aliases from ENA FASTA headers
#
# Example:
#   ENA-formatted FASTA header:
#     >ENA|CAVLGL010000001|CAVLGL010000001.1 Parnassius mnemosyne genome assembly, contig: scaffold_1
#   Alias line produced:
#     CAVLGL010000001 CAVLGL010000001.1 scaffold_1
#
# The "contig:" field may not always be present.
#
# Arguments:
#   List of file names to read from. Default: read from standard input
# Outputs:
#   Space-separated aliases are written to standard output
echo -e "#ENA\tNCBI\toriginal"
sed -En '
    # Header with contig
    s/^>(ENA\|\S+\|(\S+)).*contig:\s(\S+).*$/\1\t\2\t\3/p
    # If the substitution is successful, exit by branching to :x
    t x
    # Header without contig
    s/^>(ENA\|\S+\|(\S+)).*$/\1\t\2/p
    :x
    ' "${@:--}" # Filename argument if given, else standard input
