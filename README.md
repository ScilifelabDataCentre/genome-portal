Swedish Reference Genome Portal
========

The Swedish Reference Genome Portal (https://genomes.scilifelab.se/) :

- Showcases genome research performed in Sweden on non-model eukaryotic species.
- Lowers the barrier of entry to access, visualise, and interpret genome data. 
- Encourages sharing of genomic annotations, even the seldom-published kind.
- Strives to present FAIR data, available in public repositories.


## Table of Contents

1. [Overview](#implementation-overview)
2. [Contact us](#contact-us)
3. [Contributing](#contributing)
4. [Cite this portal](#cite-this-portal)
5. [Funding](#funding)
6. [Documentation](#development-information)
	- [Repository Layout](#repository-layout)
	- [Local development setup](#local-development-setup)
	- [Up and running!](#org6eb5bf4)


## Overview

The Swedish Reference Genome Portal website is generated by
[Hugo](https://gohugo.io/).  [JBrowse2](https://jbrowse.org/jb2/)  is
embedded to visually explore the genomic datasets. Primary data sources are
available in public repositories (such as
[ENA](https://www.ebi.ac.uk/ena/browser/home)). These upstreams
datasets are prepared for display (compressed and indexed,
essentially) by our `Makefile` recipes.

The code for the Genome Portal is available under an MIT (open source)
license.

The Genome Portal is currently hosted by the [KTH Royal
Institute of Technology](https://www.kth.se/) in Stockholm.


## Contact us

We welcome all questions and suggestions (including feature requests or bug reports).

- Email us at [dsn-eb@scilifelab.se](mailto:dsn-eb@scilifelab.se).
- Fill out our [contact form on the website](https://genomes.scilifelab.se/contact/).
- [Create an issue](https://github.com/ScilifelabDataCentre/genome-portal/issues/new)


## Contributing

Two types of contributions are espacially welcome:

- **Data**: Consult our
 [requirements](https://genomes.scilifelab.se/contribute) for
including a dataset to the portal, and contact us if you have any
questions.

- **Source code and documentation**: We welcome contributions, small
  and large, to our codebase and documentation. Fork, open a PR, or
  contact us to discuss ideas!


## Cite this portal

<a href="TODO"><img src="https://zenodo.org/badge/256458920.svg" alt="zenodo DOI"></a>

See 'Cite this repository' in the "About" section at the top right of
this page.

## Funding

This service is supported by [SciLifeLab](https://www.scilifelab.se/)
and the [Knut and Alice Wallenberg
Foundation](https://kaw.wallenberg.org/en) through the [Data-Driven
Life Science (DDLS) program](https://www.scilifelab.se/data-driven/),
and also by the [Swedish Foundation for Strategic Research
(SSF)](https://strategiska.se/en/).


## Documentation

This section contains high-level technical documentation about the
source code.

### Repository layout


- The `config/` directory contains information about data sources
  (tracks and assemblies) displayed in the genome browser.
  - Each species gets its own subdirectory (for example `config/clupea_harengus`).
  - Species directories include:
	- `config.yml` : file specifying the assembly and tracks to be displayed in JBrowse.
	- `config.json` : a starting point from which to generate a complete JBrowse2
      configuration, based on `config.yaml`. A common use is to define
      a default browsing session.

- Different `make` recipes prepare the material described in `config/`
  for use by JBrowse. The main operations are downloading data files,
  compressing using `bgzip` and indexing with `samtools`.

- The website content resides in the `hugo` directory.
  - Most importantly, each species gets:
    1. A content subdirectory in `hugo/content/species/` (e.g. `hugo/content/species/clupea_harengus`)
	2. A data directory in `hugo/data/` (taxonomic information and statistics)
	3. An assets directory in `hugo/assets` (data recensions)

- The `scripts` folder contains executables to help:
    1. build and serve the website using Docker
	2. add a new species to the website content
	3. add new datasets to the portal

- The `tests` folder contains tests and fixtures, mainly covering the
  data preparation scripts.

- The `docker` folder contains two Dockerfiles:
	1. `docker/data.dockerfile` used for data preparation (everything that ``make` needs)
	2. `docker/hugo.dockerfile` used to build and serve the website.


### Branches

This repository contains two permenant branches:
- `main`: deployable at any time, and merge target for feature branches.
- `prod`: receives merges from `main` and version tags at release time.

Work should be performed on feature branches forked from `main`, and
merged back through pull requests.

### Local development

The steps described below requires
[`docker`](https://www.docker.com/) to be installed.

**1. Clone the repository:**

```
git clone git@github.com:ScilifelabDataCentre/genome-portal.git
cd genome-portal
```

**2. Build and install the data needed by JBrowse:**

```bash
# Build local image from `docker/data.dockerfile`
./scripts/dockerbuild.sh data

# Run the dockermake script to build the assets and install them
locally.
./scripts/dockermake.sh
```
You may need to be patient, some of them are tens of Gigabytes. Should
only the herring be of interest, for example, you can restrict the
scope of the build:

```bash
# Build local image from `docker/data.dockerfile`
./scripts/dockerbuild.sh data

# build the hugo image
./scripts/dockerbuild.sh hugo
scripts/dockerserve --dev
```

The website will be then visible to you at the address: http://localhost:1313/ on your web browser.
# Run the dockermake script to build the assets and install them
locally.
./scripts/dockermake.sh SPECIES=clupea_harengus
```
All data file will end up in a `.gitignore` directory named `data`,
and a subset copied to `hugo/static/data`.

**3. Run the Hugo site locally**

```bash
